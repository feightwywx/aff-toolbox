from fastapi.testclient import TestClient

from ..main import app

client = TestClient(app)


def test_offset():
    response = client.post(
        "/aff/chart/offset",
        json={
            "params": {"allowMinusTimingNote": False, "offset": 1000},
            "notes": "(0,1);",
        },
    )
    assert response.status_code == 200
    assert response.json() == {"code": 0, "result": "(1000,1);\n"}


def test_align():
    response = client.post(
        "/aff/chart/align",
        json={"params": {"lcd": 96, "error": 0, "bpm": 222.22}, "notes": "(1, 2);"},
    )
    assert response.status_code == 200
    assert response.json() == {"code": 0, "result": "(1,2);\n"}


def test_mirror():
    response = client.post("/aff/chart/mirror", json={"notes": "(0, 1);"})
    assert response.status_code == 200
    assert response.json() == {"code": 0, "result": "(0,4);\n"}


def test_scale():
    response = client.post(
        "/aff/chart/scale", json={"params": {"scale": 1.1}, "notes": "(100,1);"}
    )
    assert response.status_code == 200
    assert response.json() == {"code": 0, "result": "(90,1);\n"}


def test_to_skyline():
    response = client.post(
        "/aff/chart/to-skyline",
        json={
            "params": {"arc_head_scale": 1.1, "arctap_scale": 1.3, "tap_scale": 1.5},
            "notes": "AudioOffset:0\n-\ntiming(0,100.00,4.00);\n(0,4);\narc(0,600,0.00,1.00,si,1.00,1.00,0,none,designant)[arctap(0),arctap(300),arctap(600)];\n(300,3);\nhold(600,900,1);\narc(600,900,0.00,0.50,s,1.00,1.00,0,none,false);\nhold(900,1200,2);\narc(900,1200,0.50,0.00,s,1.00,1.00,0,none,false);\narc(1200,1500,1.00,0.50,s,1.00,0.60,1,none,false);\narc(1500,1800,0.50,1.00,s,0.60,1.00,1,none,false);\ntiminggroup(){\n  timing(0,100.00,4.00);\n  (0,4);\n  arc(0,600,0.00,1.00,si,1.00,1.00,0,none,designant)[arctap(0),arctap(300),arctap(600)];\n  (300,3);\n  hold(600,900,1);\n  arc(600,900,0.00,0.50,s,1.00,1.00,0,none,false);\n  hold(900,1200,2);\n  arc(900,1200,0.50,0.00,s,1.00,1.00,0,none,false);\n  arc(1200,1500,1.00,0.50,s,1.00,0.60,1,none,false);\n  arc(1500,1800,0.50,1.00,s,0.60,1.00,1,none,false);\n};",
        },
    )
    assert response.status_code == 200
    assert response.json() == {
        "code": 0,
        "result": "timing(0,100.00,4.00);\narc(0,0,1.05,1.45,s,-0.20,-0.20,0,none,true);\narc(0,37,1.05,1.05,s,-0.20,-0.20,0,none,true);\narc(0,37,1.45,1.45,s,-0.20,-0.20,0,none,true);\narc(37,37,1.05,1.45,s,-0.20,-0.20,0,none,true);\narc(0,600,0.00,1.00,si,1.00,1.00,0,none,designant);\narc(0,0,-0.24,0.24,s,0.98,0.98,0,none,true);\narc(0,0,0.24,0.24,s,0.98,0.85,0,none,true);\narc(0,0,-0.24,0.24,s,0.85,0.85,0,none,true);\narc(0,0,-0.24,-0.24,s,0.98,0.85,0,none,true);\narc(0,15,-0.24,-0.24,s,0.98,0.98,0,none,true);\narc(0,15,0.24,0.24,s,0.98,0.98,0,none,true);\narc(0,15,0.24,0.24,s,0.85,0.85,0,none,true);\narc(0,15,-0.24,-0.24,s,0.85,0.85,0,none,true);\narc(15,15,-0.24,0.24,s,0.98,0.98,0,none,true);\narc(15,15,0.24,0.24,s,0.98,0.85,0,none,true);\narc(15,15,-0.24,0.24,s,0.85,0.85,0,none,true);\narc(15,15,-0.24,-0.24,s,0.98,0.85,0,none,true);\narc(300,300,0.47,0.95,s,0.98,0.98,0,none,true);\narc(300,300,0.95,0.95,s,0.98,0.85,0,none,true);\narc(300,300,0.47,0.95,s,0.85,0.85,0,none,true);\narc(300,300,0.47,0.47,s,0.98,0.85,0,none,true);\narc(300,315,0.47,0.47,s,0.98,0.98,0,none,true);\narc(300,315,0.95,0.95,s,0.98,0.98,0,none,true);\narc(300,315,0.95,0.95,s,0.85,0.85,0,none,true);\narc(300,315,0.47,0.47,s,0.85,0.85,0,none,true);\narc(315,315,0.47,0.95,s,0.98,0.98,0,none,true);\narc(315,315,0.95,0.95,s,0.98,0.85,0,none,true);\narc(315,315,0.47,0.95,s,0.85,0.85,0,none,true);\narc(315,315,0.47,0.47,s,0.98,0.85,0,none,true);\narc(600,600,0.76,1.24,s,0.98,0.98,0,none,true);\narc(600,600,1.24,1.24,s,0.98,0.85,0,none,true);\narc(600,600,0.76,1.24,s,0.85,0.85,0,none,true);\narc(600,600,0.76,0.76,s,0.98,0.85,0,none,true);\narc(600,615,0.76,0.76,s,0.98,0.98,0,none,true);\narc(600,615,1.24,1.24,s,0.98,0.98,0,none,true);\narc(600,615,1.24,1.24,s,0.85,0.85,0,none,true);\narc(600,615,0.76,0.76,s,0.85,0.85,0,none,true);\narc(615,615,0.76,1.24,s,0.98,0.98,0,none,true);\narc(615,615,1.24,1.24,s,0.98,0.85,0,none,true);\narc(615,615,0.76,1.24,s,0.85,0.85,0,none,true);\narc(615,615,0.76,0.76,s,0.98,0.85,0,none,true);\narc(300,300,0.55,0.95,s,-0.20,-0.20,0,none,true);\narc(300,337,0.55,0.55,s,-0.20,-0.20,0,none,true);\narc(300,337,0.95,0.95,s,-0.20,-0.20,0,none,true);\narc(337,337,0.55,0.95,s,-0.20,-0.20,0,none,true);\narc(600,600,-0.45,-0.05,s,-0.20,-0.20,0,none,true);\narc(600,900,-0.45,-0.45,s,-0.20,-0.20,0,none,true);\narc(600,900,-0.05,-0.05,s,-0.20,-0.20,0,none,true);\narc(900,900,-0.45,-0.05,s,-0.20,-0.20,0,none,true);\narc(600,600,-0.09,0.00,s,0.93,1.09,0,none,true);\narc(600,600,0.00,0.09,s,1.09,0.93,0,none,true);\narc(600,900,-0.09,0.41,s,0.93,0.93,0,none,true);\narc(600,900,0.00,0.50,s,1.09,1.09,0,none,true);\narc(600,900,0.09,0.59,s,0.93,0.93,0,none,true);\narc(900,900,0.41,0.50,s,0.93,1.09,0,none,true);\narc(900,900,0.50,0.59,s,1.09,0.93,0,none,true);\narc(900,900,0.05,0.45,s,-0.20,-0.20,0,none,true);\narc(900,1200,0.05,0.05,s,-0.20,-0.20,0,none,true);\narc(900,1200,0.45,0.45,s,-0.20,-0.20,0,none,true);\narc(1200,1200,0.05,0.45,s,-0.20,-0.20,0,none,true);\narc(900,900,0.41,0.50,s,0.93,1.09,0,none,true);\narc(900,900,0.50,0.59,s,1.09,0.93,0,none,true);\narc(900,1200,0.41,-0.09,s,0.93,0.93,0,none,true);\narc(900,1200,0.50,0.00,s,1.09,1.09,0,none,true);\narc(900,1200,0.59,0.09,s,0.93,0.93,0,none,true);\narc(1200,1200,-0.09,0.00,s,0.93,1.09,0,none,true);\narc(1200,1200,0.00,0.09,s,1.09,0.93,0,none,true);\narc(1200,1200,0.91,1.00,s,0.93,1.09,1,none,true);\narc(1200,1200,1.00,1.09,s,1.09,0.93,1,none,true);\narc(1200,1500,0.91,0.41,s,0.93,0.53,1,none,true);\narc(1200,1500,1.00,0.50,s,1.09,0.69,1,none,true);\narc(1200,1500,1.09,0.59,s,0.93,0.53,1,none,true);\narc(1500,1500,0.41,0.50,s,0.53,0.69,1,none,true);\narc(1500,1500,0.50,0.59,s,0.69,0.53,1,none,true);\narc(1500,1500,0.41,0.50,s,0.53,0.69,1,none,true);\narc(1500,1500,0.50,0.59,s,0.69,0.53,1,none,true);\narc(1500,1800,0.41,0.91,s,0.53,0.93,1,none,true);\narc(1500,1800,0.50,1.00,s,0.69,1.09,1,none,true);\narc(1500,1800,0.59,1.09,s,0.53,0.93,1,none,true);\narc(1800,1800,0.91,1.00,s,0.93,1.09,1,none,true);\narc(1800,1800,1.00,1.09,s,1.09,0.93,1,none,true);\ntiminggroup(){\n  timing(0,100.00,4.00);\n  arc(0,0,1.05,1.45,s,-0.20,-0.20,0,none,true);\n  arc(0,37,1.05,1.05,s,-0.20,-0.20,0,none,true);\n  arc(0,37,1.45,1.45,s,-0.20,-0.20,0,none,true);\n  arc(37,37,1.05,1.45,s,-0.20,-0.20,0,none,true);\n  arc(0,600,0.00,1.00,si,1.00,1.00,0,none,designant);\n  arc(0,0,-0.24,0.24,s,0.98,0.98,0,none,true);\n  arc(0,0,0.24,0.24,s,0.98,0.85,0,none,true);\n  arc(0,0,-0.24,0.24,s,0.85,0.85,0,none,true);\n  arc(0,0,-0.24,-0.24,s,0.98,0.85,0,none,true);\n  arc(0,15,-0.24,-0.24,s,0.98,0.98,0,none,true);\n  arc(0,15,0.24,0.24,s,0.98,0.98,0,none,true);\n  arc(0,15,0.24,0.24,s,0.85,0.85,0,none,true);\n  arc(0,15,-0.24,-0.24,s,0.85,0.85,0,none,true);\n  arc(15,15,-0.24,0.24,s,0.98,0.98,0,none,true);\n  arc(15,15,0.24,0.24,s,0.98,0.85,0,none,true);\n  arc(15,15,-0.24,0.24,s,0.85,0.85,0,none,true);\n  arc(15,15,-0.24,-0.24,s,0.98,0.85,0,none,true);\n  arc(300,300,0.47,0.95,s,0.98,0.98,0,none,true);\n  arc(300,300,0.95,0.95,s,0.98,0.85,0,none,true);\n  arc(300,300,0.47,0.95,s,0.85,0.85,0,none,true);\n  arc(300,300,0.47,0.47,s,0.98,0.85,0,none,true);\n  arc(300,315,0.47,0.47,s,0.98,0.98,0,none,true);\n  arc(300,315,0.95,0.95,s,0.98,0.98,0,none,true);\n  arc(300,315,0.95,0.95,s,0.85,0.85,0,none,true);\n  arc(300,315,0.47,0.47,s,0.85,0.85,0,none,true);\n  arc(315,315,0.47,0.95,s,0.98,0.98,0,none,true);\n  arc(315,315,0.95,0.95,s,0.98,0.85,0,none,true);\n  arc(315,315,0.47,0.95,s,0.85,0.85,0,none,true);\n  arc(315,315,0.47,0.47,s,0.98,0.85,0,none,true);\n  arc(600,600,0.76,1.24,s,0.98,0.98,0,none,true);\n  arc(600,600,1.24,1.24,s,0.98,0.85,0,none,true);\n  arc(600,600,0.76,1.24,s,0.85,0.85,0,none,true);\n  arc(600,600,0.76,0.76,s,0.98,0.85,0,none,true);\n  arc(600,615,0.76,0.76,s,0.98,0.98,0,none,true);\n  arc(600,615,1.24,1.24,s,0.98,0.98,0,none,true);\n  arc(600,615,1.24,1.24,s,0.85,0.85,0,none,true);\n  arc(600,615,0.76,0.76,s,0.85,0.85,0,none,true);\n  arc(615,615,0.76,1.24,s,0.98,0.98,0,none,true);\n  arc(615,615,1.24,1.24,s,0.98,0.85,0,none,true);\n  arc(615,615,0.76,1.24,s,0.85,0.85,0,none,true);\n  arc(615,615,0.76,0.76,s,0.98,0.85,0,none,true);\n  arc(300,300,0.55,0.95,s,-0.20,-0.20,0,none,true);\n  arc(300,337,0.55,0.55,s,-0.20,-0.20,0,none,true);\n  arc(300,337,0.95,0.95,s,-0.20,-0.20,0,none,true);\n  arc(337,337,0.55,0.95,s,-0.20,-0.20,0,none,true);\n  arc(600,600,-0.45,-0.05,s,-0.20,-0.20,0,none,true);\n  arc(600,900,-0.45,-0.45,s,-0.20,-0.20,0,none,true);\n  arc(600,900,-0.05,-0.05,s,-0.20,-0.20,0,none,true);\n  arc(900,900,-0.45,-0.05,s,-0.20,-0.20,0,none,true);\n  arc(600,600,-0.09,0.00,s,0.93,1.09,0,none,true);\n  arc(600,600,0.00,0.09,s,1.09,0.93,0,none,true);\n  arc(600,900,-0.09,0.41,s,0.93,0.93,0,none,true);\n  arc(600,900,0.00,0.50,s,1.09,1.09,0,none,true);\n  arc(600,900,0.09,0.59,s,0.93,0.93,0,none,true);\n  arc(900,900,0.41,0.50,s,0.93,1.09,0,none,true);\n  arc(900,900,0.50,0.59,s,1.09,0.93,0,none,true);\n  arc(900,900,0.05,0.45,s,-0.20,-0.20,0,none,true);\n  arc(900,1200,0.05,0.05,s,-0.20,-0.20,0,none,true);\n  arc(900,1200,0.45,0.45,s,-0.20,-0.20,0,none,true);\n  arc(1200,1200,0.05,0.45,s,-0.20,-0.20,0,none,true);\n  arc(900,900,0.41,0.50,s,0.93,1.09,0,none,true);\n  arc(900,900,0.50,0.59,s,1.09,0.93,0,none,true);\n  arc(900,1200,0.41,-0.09,s,0.93,0.93,0,none,true);\n  arc(900,1200,0.50,0.00,s,1.09,1.09,0,none,true);\n  arc(900,1200,0.59,0.09,s,0.93,0.93,0,none,true);\n  arc(1200,1200,-0.09,0.00,s,0.93,1.09,0,none,true);\n  arc(1200,1200,0.00,0.09,s,1.09,0.93,0,none,true);\n  arc(1200,1200,0.91,1.00,s,0.93,1.09,1,none,true);\n  arc(1200,1200,1.00,1.09,s,1.09,0.93,1,none,true);\n  arc(1200,1500,0.91,0.41,s,0.93,0.53,1,none,true);\n  arc(1200,1500,1.00,0.50,s,1.09,0.69,1,none,true);\n  arc(1200,1500,1.09,0.59,s,0.93,0.53,1,none,true);\n  arc(1500,1500,0.41,0.50,s,0.53,0.69,1,none,true);\n  arc(1500,1500,0.50,0.59,s,0.69,0.53,1,none,true);\n  arc(1500,1500,0.41,0.50,s,0.53,0.69,1,none,true);\n  arc(1500,1500,0.50,0.59,s,0.69,0.53,1,none,true);\n  arc(1500,1800,0.41,0.91,s,0.53,0.93,1,none,true);\n  arc(1500,1800,0.50,1.00,s,0.69,1.09,1,none,true);\n  arc(1500,1800,0.59,1.09,s,0.53,0.93,1,none,true);\n  arc(1800,1800,0.91,1.00,s,0.93,1.09,1,none,true);\n  arc(1800,1800,1.00,1.09,s,1.09,0.93,1,none,true);\n  arc(594,600,0.00,0.00,s,0.93,1.09,0,none,true);\n  arc(594,600,0.00,-0.09,s,0.93,0.93,0,none,true);\n  arc(594,600,0.00,0.09,s,0.93,0.93,0,none,true);\n  arc(600,600,0.00,0.00,s,-0.20,0.93,0,none,true);\n  arc(1500,1500,0.50,0.50,s,-0.20,0.53,1,none,true);\n};\narc(594,600,0.00,0.00,s,0.93,1.09,0,none,true);\narc(594,600,0.00,-0.09,s,0.93,0.93,0,none,true);\narc(594,600,0.00,0.09,s,0.93,0.93,0,none,true);\narc(600,600,0.00,0.00,s,-0.20,0.93,0,none,true);\narc(1500,1500,0.50,0.50,s,-0.20,0.53,1,none,true);\n",
    }
